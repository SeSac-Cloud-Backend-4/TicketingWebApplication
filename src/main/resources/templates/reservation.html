<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- <link th:href="@{/style.css}" href="style.css" rel="stylesheet"> -->
    <title>게시판 페이지</title>

    <style>
        .c{
            width: 70rem;
            height: 30rem;
        }
    </style>
</head>
<body>
    <!--헤더-->
    <header class="p-3 bg-dark text-white">
        <div class="container">
            <div class="d-flex flex-wrap align-items-center justify-content-center justify-content-lg-start">
                <a href="/" class="d-flex align-items-center mb-2 mb-lg-0 text-white text-decoration-none">
                    <svg class="bi me-2" width="40" height="32" role="img" aria-label="Bootstrap"><use xlink:href="#bootstrap"></use></svg>
                </a>

                <ul class="nav col-12 col-lg-auto me-lg-auto mb-2 justify-content-center mb-md-0">
                    <li><a th:href="@{/}" href="#" class="nav-link px-2 text-white">Title</a></li>
                    <li><a href="/test/show/movie" class="nav-link px-2 text-white">Movie</a></li>
                    <li><a href="/test/show/play" class="nav-link px-2 text-white">Play</a></li>
                    <li><a href="/test/show/concert" class="nav-link px-2 text-white">Conecert</a></li>
                </ul>

                <div class="text-end">
                    <button type="button" class="btn btn-outline-light me-2">Login</button>
                    <button type="button" class="btn btn-warning">My-page</button>
                </div>
            </div>
        </div>
    </header>

    <!--메인-->
    <div class="container p-5 mb-4 bg-light rounded-3 h-100 pt-0 ">
        <div class="container-fluid py-5 pb-1 ">
            <h1 th:text="${show.name}" class="display-5 text-starter fw-bold mb-4">${show.classificaiton} : ${show.name}</h1>
            <hr/>
            <img th:src="@{${show.posterURI}}" src="./img/test1.jpeg" class=" c rounded-3 img-thumbnail">
            <hr/>
        </div>
        <div class="container-fluid py-5 pt-1 pb-1 ">
            <form>
                <select id="selectdate" class="form-select form-select-lg mb-3 col-6" aria-label="date" onchange="dateSelect()">
                    <option value="0">==공연 날짜 선택==</option>
                    <option th:each="showdate : ${show.showDate}" th:value="${showdate}"
                            th:text="${showdate}">NULL</option>
                </select>
                <select id="selectgrade" class="form-select form-select-lg mb-3" aria-label="seat_grade" onchange="gradeSelect()">
                    <option value="0">==좌석 등급 선택==</option>
                    <option th:each="grade : ${gradeList}" th:value="${grade}"
                            th:text="${grade}" >NULL</option>
                </select>
                <hr/>
                <div class="row mt-4 mb-3">
                    <span id="seat" class="display-5 fw-bold text-left">좌석: 0 / 0 </span>
                    <hr>
                    <span id="price" class="display-5 fw-bold text-right">가격 : 0 원</span>
                </div>
                <hr/>
                <button type="button" class="w-100 btn col-md-2 btn-primary"><h1>예매</h1></button>
            </form>
        </div>
    </div>

    <!--풋터-->
    <footer class="container d-flex flex-wrap justify-content-between align-items-center py-3 my-4 border-top">
        <div class="col-md-4 d-flex align-items-center">
        <a href="/" class="mb-3 me-2 mb-md-0 text-muted text-decoration-none lh-1">
            <svg class="bi" width="30" height="24"><use xlink:href="#bootstrap"></use></svg>
        </a>
        <span class="text-muted">© 2021 SESAC</span>
        </div>
    
        <ul class="nav col-md-4 justify-content-end list-unstyled d-flex">
        <li class="ms-3"><a class="text-muted" href="#"><svg class="bi" width="24" height="24"><use xlink:href="#twitter"></use></svg></a></li>
        <li class="ms-3"><a class="text-muted" href="#"><svg class="bi" width="24" height="24"><use xlink:href="#instagram"></use></svg></a></li>
        <li class="ms-3"><a class="text-muted" href="#"><svg class="bi" width="24" height="24"><use xlink:href="#facebook"></use></svg></a></li>
        </ul>
    </footer>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="/js/reservation.js"></script>
    <script th:inline="javascript">
        var jsSeatsList =[[${seats}]];
        var seatId;
        var seatPrice;
        var seatTotalSeat;
        var seatCurrentCount;

        var isDateSelected = false;
        var isGradeSelected = false;
        var dateValue
        var gradeValue

        function dateSelect(){
            var dateSelected = document.getElementById("selectdate");
            dateValue = dateSelected.options[dateSelected.selectedIndex].value;

            if(dateValue === "0") {
                isDateSelected = false;
            } else if(isGradeSelected!==false){
                isDateSelected =true;
                //출력 과정에서 바꿨습니다. 함수로 정리하겠습니다.
                for(var jsSeat of jsSeatsList){
                    if(jsSeat.showDate==(dateValue+":00") && jsSeat.grade == gradeValue){
                        seatId=jsSeat.id;
                        seatShowDate=jsSeat.showDate;
                        seatPrice=jsSeat.price;
                        seatCurrentCount=jsSeat.currentCount;
                        seatTotalSeat=jsSeat.totalSeat;
                    }
                }
                document.getElementById('seat').innerText = "좌석 : "+(seatTotalSeat-seatCurrentCount)+" / "+seatTotalSeat;
                document.getElementById('price').innerText = "가격 : "+seatPrice+" 원";
            }else{
                isDateSelected =true;
            }

        }

        function gradeSelect() {
            var gradeSelected = document.getElementById("selectgrade");
            gradeValue = gradeSelected.options[gradeSelected.selectedIndex].value;
            console.log(gradeValue);

            if(gradeValue === "0") {
                isGradeSelected = false;
            } else if(isDateSelected!==false){
                isGradeSelected=true
                //출력 과정에서 바꿨습니다. 함수로 정리하겠습니다.
                for(var jsSeat of jsSeatsList){
                    if(jsSeat.showDate==(dateValue+":00") && jsSeat.grade == gradeValue){
                        seatId=jsSeat.id;
                        seatShowDate=jsSeat.showDate;
                        seatPrice=jsSeat.price;
                        seatCurrentCount=jsSeat.currentCount;
                        seatTotalSeat=jsSeat.totalSeat;
                    }
                }
                document.getElementById('seat').innerText = "좌석 : "+(seatTotalSeat-seatCurrentCount)+" / "+seatTotalSeat;
                document.getElementById('price').innerText = "가격 : "+seatPrice+" 원";
            }else{
                isGradeSelected=true;
            }

        }

    </script>
</body>
